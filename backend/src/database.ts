import Database, { Database as DatabaseType } from 'better-sqlite3';
import path from 'path';
import { v4 as uuidv4 } from 'uuid';

const dbPath = path.join(__dirname, '..', 'data', 'tracker.db');
const db: DatabaseType = new Database(dbPath);

// –í–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
db.pragma('foreign_keys = ON');

// –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—ã
db.exec(`
  -- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  CREATE TABLE IF NOT EXISTS users (
    id TEXT PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    full_name TEXT NOT NULL,
    role TEXT NOT NULL CHECK(role IN ('admin', 'buyer', 'webdev', 'creo_manager', 'buying_head', 'bizdev', 'creo_head', 'dev_head')),
    telegram_chat_id TEXT,
    telegram_username TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–∫ (–ü–ü)
  CREATE TABLE IF NOT EXISTS partners (
    id TEXT PRIMARY KEY,
    name TEXT UNIQUE NOT NULL,
    description TEXT,
    website TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by TEXT REFERENCES users(id)
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤
  CREATE TABLE IF NOT EXISTS offers (
    id TEXT PRIMARY KEY,
    partner_id TEXT NOT NULL REFERENCES partners(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    theme TEXT NOT NULL,
    partner_link TEXT,
    landing_price TEXT,
    promo_link TEXT,
    payout TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by TEXT REFERENCES users(id)
  );

  -- –¢–∞–±–ª–∏—Ü–∞ —Ç–∞—Å–∫–æ–≤
  CREATE TABLE IF NOT EXISTS tasks (
    id TEXT PRIMARY KEY,
    task_number INTEGER,
    title TEXT NOT NULL,
    description TEXT,
    task_type TEXT NOT NULL,
    geo TEXT,
    department TEXT CHECK(department IN ('buying', 'creo', 'development')),
    customer_id TEXT NOT NULL REFERENCES users(id),
    executor_id TEXT NOT NULL REFERENCES users(id),
    deadline DATETIME NOT NULL,
    status TEXT NOT NULL DEFAULT 'pending' CHECK(status IN ('pending', 'in_progress', 'completed', 'cancelled')),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME
  );

  -- –¢–∞–±–ª–∏—Ü–∞ —Ñ–∞–π–ª–æ–≤
  CREATE TABLE IF NOT EXISTS task_files (
    id TEXT PRIMARY KEY,
    task_id TEXT NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    original_name TEXT NOT NULL,
    stored_name TEXT NOT NULL,
    mime_type TEXT NOT NULL,
    size INTEGER NOT NULL,
    uploaded_by TEXT NOT NULL REFERENCES users(id),
    is_result INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  CREATE TABLE IF NOT EXISTS notifications (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    type TEXT NOT NULL,
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    task_id TEXT REFERENCES tasks(id) ON DELETE CASCADE,
    is_read INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º
  CREATE TABLE IF NOT EXISTS task_comments (
    id TEXT PRIMARY KEY,
    task_id TEXT NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    message TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–¥–µ–ª–æ–≤
  CREATE TABLE IF NOT EXISTS departments (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    code TEXT NOT NULL UNIQUE CHECK(code IN ('buying', 'creo', 'development')),
    head_id TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—Ç–¥–µ–ª–æ–≤
  CREATE TABLE IF NOT EXISTS user_departments (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    department_id TEXT NOT NULL REFERENCES departments(id) ON DELETE CASCADE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, department_id)
  );

  -- –¢–∞–±–ª–∏—Ü–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π –æ—Ç–¥–µ–ª–æ–≤ (–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)
  CREATE TABLE IF NOT EXISTS department_heads (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    department_id TEXT NOT NULL REFERENCES departments(id) ON DELETE CASCADE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, department_id)
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
  CREATE TABLE IF NOT EXISTS knowledge_categories (
    id TEXT PRIMARY KEY,
    department_code TEXT NOT NULL CHECK(department_code IN ('buying', 'creo', 'development')),
    title TEXT NOT NULL,
    icon TEXT DEFAULT 'FileText',
    sort_order INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
  CREATE TABLE IF NOT EXISTS knowledge_instructions (
    id TEXT PRIMARY KEY,
    category_id TEXT NOT NULL REFERENCES knowledge_categories(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    tags TEXT,
    sort_order INTEGER DEFAULT 0,
    created_by TEXT REFERENCES users(id),
    updated_by TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  CREATE TABLE IF NOT EXISTS user_permissions (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    permission TEXT NOT NULL,
    granted_by TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, permission)
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
  CREATE TABLE IF NOT EXISTS achievements (
    id TEXT PRIMARY KEY,
    code TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    description TEXT NOT NULL,
    icon TEXT NOT NULL,
    category TEXT NOT NULL CHECK(category IN ('tasks', 'quality', 'speed', 'streak', 'special')),
    threshold INTEGER DEFAULT 1,
    sort_order INTEGER DEFAULT 0
  );

  -- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  CREATE TABLE IF NOT EXISTS user_achievements (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    achievement_id TEXT NOT NULL REFERENCES achievements(id) ON DELETE CASCADE,
    earned_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, achievement_id)
  );
`);

// –ú–∏–≥—Ä–∞—Ü–∏–∏
try {
  // –ú–∏–≥—Ä–∞—Ü–∏—è users: –æ–±–Ω–æ–≤–ª—è–µ–º CHECK constraint –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–æ–ª–µ–π
  const checkInfo = db.prepare("SELECT sql FROM sqlite_master WHERE type='table' AND name='users'").get() as { sql: string } | undefined;
  if (checkInfo && !checkInfo.sql.includes('dev_head')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
    db.exec(`
      -- –û—Ç–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
      PRAGMA foreign_keys = OFF;
      
      -- –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º constraint
      CREATE TABLE users_new (
        id TEXT PRIMARY KEY,
        username TEXT UNIQUE NOT NULL,
        password TEXT NOT NULL,
        full_name TEXT NOT NULL,
        role TEXT NOT NULL CHECK(role IN ('admin', 'buyer', 'webdev', 'creo_manager', 'buying_head', 'bizdev', 'creo_head', 'dev_head')),
        telegram_chat_id TEXT,
        telegram_username TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );
      
      -- –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
      INSERT INTO users_new SELECT id, username, password, full_name, role, telegram_chat_id, telegram_username, created_at FROM users;
      
      -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É
      DROP TABLE users;
      
      -- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –Ω–æ–≤—É—é
      ALTER TABLE users_new RENAME TO users;
      
      -- –í–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –æ–±—Ä–∞—Ç–Ω–æ
      PRAGMA foreign_keys = ON;
    `);
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è users: telegram –∫–æ–ª–æ–Ω–∫–∏
  const userColumns = db.prepare("PRAGMA table_info(users)").all() as Array<{ name: string }>;
  const userColumnNames = userColumns.map(c => c.name);
  
  if (!userColumnNames.includes('telegram_chat_id')) {
    db.exec('ALTER TABLE users ADD COLUMN telegram_chat_id TEXT');
  }
  if (!userColumnNames.includes('telegram_username')) {
    db.exec('ALTER TABLE users ADD COLUMN telegram_username TEXT');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: task_number –∏ geo
  const taskColumns = db.prepare("PRAGMA table_info(tasks)").all() as Array<{ name: string }>;
  const taskColumnNames = taskColumns.map(c => c.name);
  
  if (!taskColumnNames.includes('task_number')) {
    db.exec('ALTER TABLE tasks ADD COLUMN task_number INTEGER');
    // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∑–∞–¥–∞—á–∞–º
    const existingTasks = db.prepare('SELECT id FROM tasks ORDER BY created_at ASC').all() as Array<{ id: string }>;
    existingTasks.forEach((task, index) => {
      db.prepare('UPDATE tasks SET task_number = ? WHERE id = ?').run(index + 1, task.id);
    });
  }
  if (!taskColumnNames.includes('geo')) {
    db.exec('ALTER TABLE tasks ADD COLUMN geo TEXT');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è offers: geo –∫–æ–ª–æ–Ω–∫–∞
  const offerColumns = db.prepare("PRAGMA table_info(offers)").all() as Array<{ name: string }>;
  const offerColumnNames = offerColumns.map(c => c.name);
  
  if (!offerColumnNames.includes('geo')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ GEO –∫ –æ—Ñ—Ñ–µ—Ä–∞–º...');
    db.exec('ALTER TABLE offers ADD COLUMN geo TEXT');
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è GEO –¥–ª—è –æ—Ñ—Ñ–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è offers: payment_type –∫–æ–ª–æ–Ω–∫–∞ (COD –∏–ª–∏ SS)
  if (!offerColumnNames.includes('payment_type')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ payment_type –∫ –æ—Ñ—Ñ–µ—Ä–∞–º...');
    db.exec("ALTER TABLE offers ADD COLUMN payment_type TEXT CHECK(payment_type IN ('COD', 'SS'))");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è payment_type –¥–ª—è –æ—Ñ—Ñ–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è offers: garant –∫–æ–ª–æ–Ω–∫–∞
  if (!offerColumnNames.includes('garant')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ garant –∫ –æ—Ñ—Ñ–µ—Ä–∞–º...');
    db.exec("ALTER TABLE offers ADD COLUMN garant TEXT");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è garant –¥–ª—è –æ—Ñ—Ñ–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è offers: cap –∫–æ–ª–æ–Ω–∫–∞
  if (!offerColumnNames.includes('cap')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ cap –∫ –æ—Ñ—Ñ–µ—Ä–∞–º...');
    db.exec("ALTER TABLE offers ADD COLUMN cap TEXT");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è cap –¥–ª—è –æ—Ñ—Ñ–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: started_at –∫–æ–ª–æ–Ω–∫–∞ (–∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –≤–∑—è—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É)
  if (!taskColumnNames.includes('started_at')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ started_at –∫ –∑–∞–¥–∞—á–∞–º...');
    db.exec("ALTER TABLE tasks ADD COLUMN started_at DATETIME");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è started_at –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: priority –∫–æ–ª–æ–Ω–∫–∞
  if (!taskColumnNames.includes('priority')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫ –∑–∞–¥–∞—á–∞–º...');
    db.exec("ALTER TABLE tasks ADD COLUMN priority TEXT DEFAULT 'normal'");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: department –∫–æ–ª–æ–Ω–∫–∞
  if (!taskColumnNames.includes('department')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ –∫ –∑–∞–¥–∞—á–∞–º...');
    db.exec("ALTER TABLE tasks ADD COLUMN department TEXT CHECK(department IN ('buying', 'creo', 'development'))");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç–¥–µ–ª–∞ –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: offer_id –∫–æ–ª–æ–Ω–∫–∞
  if (!taskColumnNames.includes('offer_id')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ offer_id –∫ –∑–∞–¥–∞—á–∞–º...');
    db.exec("ALTER TABLE tasks ADD COLUMN offer_id TEXT REFERENCES offers(id)");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è offer_id –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è tasks: rating –∫–æ–ª–æ–Ω–∫–∞ (–æ—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: bad, ok, top)
  if (!taskColumnNames.includes('rating')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ rating –∫ –∑–∞–¥–∞—á–∞–º...');
    db.exec("ALTER TABLE tasks ADD COLUMN rating TEXT CHECK(rating IN ('bad', 'ok', 'top'))");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è rating –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è users: settings –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
  if (!userColumnNames.includes('settings')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏...');
    db.exec("ALTER TABLE users ADD COLUMN settings TEXT");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤
  const existingDepartments = db.prepare('SELECT COUNT(*) as count FROM departments').get() as { count: number };
  if (existingDepartments.count === 0) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤...');
    const { v4: uuidv4 } = require('uuid');
    db.prepare('INSERT INTO departments (id, name, code) VALUES (?, ?, ?)').run(uuidv4(), '–ë–∞–∏–Ω–≥', 'buying');
    db.prepare('INSERT INTO departments (id, name, code) VALUES (?, ?, ?)').run(uuidv4(), '–ö—Ä–µ–æ', 'creo');
    db.prepare('INSERT INTO departments (id, name, code) VALUES (?, ?, ?)').run(uuidv4(), '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞', 'development');
    console.log('‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ –æ—Ç–¥–µ–ª—ã —Å–æ–∑–¥–∞–Ω—ã');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
  const existingKnowledgeCategories = db.prepare('SELECT COUNT(*) as count FROM knowledge_categories').get() as { count: number };
  if (existingKnowledgeCategories.count === 0) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...');
    const { v4: uuidv4 } = require('uuid');
    
    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–†–∞–±–æ—Ç–∞ —Å –æ—Ñ—Ñ–µ—Ä–∞–º–∏"
    const offersCategoryId = uuidv4();
    db.prepare('INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order) VALUES (?, ?, ?, ?, ?)').run(
      offersCategoryId, 'development', '–†–∞–±–æ—Ç–∞ —Å –æ—Ñ—Ñ–µ—Ä–∞–º–∏', 'Globe', 1
    );

    // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è "–ó–∞–≤–µ–¥–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤"
    const offersInstructionContent = `# –ó–∞–≤–µ–¥–µ–Ω–∏–µ –û—Ñ—Ñ–µ—Ä–æ–≤

–ü—Ä–∏ –∑–∞–≤–µ–¥–µ–Ω–∏–∏ –û—Ñ—Ñ–µ—Ä–∞ (—Ä–æ–≤–Ω–æ –∫–∞–∫ –∏ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–Ω–∏–∏ –õ–µ–Ω–¥–∏–Ω–≥–∞ –≤ –û—Ñ—Ñ–µ—Ä) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–æ–π **–ü—Ä–æ–¥—É–∫—Ç** –∏ –∏–∑ –∫–∞–∫–æ–π **–ü–ü** –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

## 1. –û—á–∏—Å—Ç–∫–∞ –û—Ñ—Ñ–µ—Ä–∞

–û—Ñ—Ñ–µ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—á–∏—Å—Ç–∏—Ç—å –æ—Ç:

- [ ] –°—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- [ ] –õ–∏—à–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ (–∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö JS, —Ç–∞–∫ –∏ –≤ index)
- [ ] –ö–Ω–æ–ø–æ–∫ –≤ –∫–æ–Ω—Ü–µ —Å—Ç–∞—Ç—å–∏ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏)

### –í–∞–∂–Ω–æ!
- –ö–Ω–æ–ø–∫–∏ –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ **—Ñ–æ—Ä–º—É**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –±–µ—Ä—ë–º –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–º –û—Ñ—Ñ–µ—Ä–µ –∏–ª–∏ –≤ –®–∞–±–ª–æ–Ω–Ω–æ–º
- **–í—Å–µ –ª–∏—à–Ω–∏–µ –ø–æ–ª—è –∏/–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã ‚Äî –£–î–ê–õ–Ø–ï–ú, –∞ –Ω–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º!**

---

## 2. –°—Å—ã–ª–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –û—Ñ—Ñ–µ—Ä–∞ **–í–°–ï —Å—Å—ã–ª–∫–∏** –¥–æ–ª–∂–Ω—ã –≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω–µ—Ü —Å—Ç–∞—Ç—å–∏ –∫ —Ñ–æ—Ä–º–µ, –∞ –ª—é–±–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º.

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º—ã

–§–æ—Ä–º–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ü–ü, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ò–º–µ–Ω–∞ –ø–æ–ª–µ–π –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç –ü–ü –∫ –ü–ü
- –ù–æ –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç—É **–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –ü–ü**

### –ü—Ä–∏–º–µ—Ä:
–ó–∞–≤–æ–¥—è/–ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—è –û—Ñ—Ñ–µ—Ä (–∫ –ø—Ä–∏–º–µ—Ä—É OpenAff) ‚Äî –º–æ–∂–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ \`name\` –ø–æ–ª–µ–π –ø–æ–¥–≥–ª—è–¥–µ—Ç—å –≤ –ª—é–±–æ–º –∑–∞–≤–µ–¥—ë–Ω–Ω–æ–º —Ä–∞–Ω–µ–µ OpenAff –ø—Ä–æ–¥—É–∫—Ç–µ –∏/–∏–ª–∏ —à–∞–±–ª–æ–Ω–Ω–æ–º.

---

## 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π

–í–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ–ª–µ–π **–≤—Å–µ–≥–¥–∞** —Ä–µ–∞–ª–∏–∑—É–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤–æ:

- –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤/–∫–æ–¥–æ–≤ –≥–æ—Ä–æ–¥–∞, —Ç–µ–∫—Å—Ç–∞ –≤ –∏–Ω–ø—É—Ç–∞—Ö —É–¥–æ–±–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ **–ó–ê –ø—Ä–µ–¥–µ–ª—ã index** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π JS)
- –¢–û –Ω–∞ –≤—Å–µ—Ö –û—Ñ—Ñ–µ—Ä–∞—Ö –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º JS –∏ –¥–µ—Ä–∂–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–æ –±–∞—Ä–¥–∞–∫–∞ —Å —Ñ–æ—Ä–º–∞–º–∏ –∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

### –¶–µ–ª—å:
–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–π—Ç–∏ –∫ **–æ–±—â–µ–º—É —Ñ–æ—Ä–º–∞—Ç—É —Ñ–æ—Ä–º—ã** –≤ –û—Ñ—Ñ–µ—Ä–∞—Ö.

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–¥ –Ω–∞—Å –û—Ñ—Ñ–µ—Ä—ã –æ—Ç –ü–ü (–∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–æ–º–µ—á–∞–µ–º –≤ –Ω–µ–π–º–∏–Ω–≥–µ \`DAFULT\`) ‚Äî –∏–∑ —ç—Ç–∏—Ö –û—Ñ—Ñ–µ—Ä–æ–≤ –º—ã –º–æ–∂–µ–º –±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–Ω—ã–µ ID –∏–∑ \`send.php\`.

---

## 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –û—Ñ—Ñ–µ—Ä–∞

–ù–æ–≤—ã–π –û—Ñ—Ñ–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å –Ω–µ–π–º–∏–Ω–≥–æ–º:

\`\`\`
–ü–†–û–î–£–ö–¢ [–ì–ï–û][–ü–û–î–•–û–î][–°–ï–õ–ï–ë–ê]
\`\`\`

### –ü—Ä–∞–≤–∏–ª–∞:
- –ï—Å–ª–∏ –û—Ñ—Ñ–µ—Ä **–ù–ï —Å–µ–ª–µ–±–Ω—ã–π** ‚Äî –±–ª–æ–∫ —Å —Å–µ–ª–µ–±–æ–π –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º
- –ì—Ä—É–ø–ø—É —É–∫–∞–∑—ã–≤–∞–µ–º \`TEST\`
- –£–∫–∞–∑—ã–≤–∞–µ–º –ü–ü –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ ¬´–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è —Å–µ—Ç—å¬ª
- –£–∫–∞–∑—ã–≤–∞–µ–º –ì–ï–û –û—Ñ—Ñ–µ—Ä–∞ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª

---

## 6. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü—Ä–æ–≤–µ—Ä—è–µ–º –û—Ñ—Ñ–µ—Ä –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—É–Ω–∫—Ç–æ–≤:

- [ ] –í –û—Ñ—Ñ–µ—Ä–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
- [ ] –í—Å–µ —Å—Å—ã–ª–∫–∏ –¥–æ–ª–∂–Ω—ã –≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω–µ—Ü —Å—Ç–∞—Ç—å–∏ –∫ —Ñ–æ—Ä–º–µ
- [ ] –í –û—Ñ—Ñ–µ—Ä–µ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–• —Å–∫—Ä–∏–ø—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–π \`intlTelInput.js\`)
- [ ] –í—Å–µ —Å—Ç–∏–ª–∏ –û—Ñ—Ñ–µ—Ä–∞ –ù–ï –Ω–∞—Ä—É—à–µ–Ω—ã
- [ ] –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –û—Ñ—Ñ–µ—Ä–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞

---

## 7. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

1. –ü–µ—Ä–µ–≤–æ–¥–∏–º –û—Ñ—Ñ–µ—Ä –≤ –≥—Ä—É–ø–ø—É \`DONE\`
2. –û—Ç–ø–∏—Å—ã–≤–∞–µ–º —Ç–∞—Å–∫-–∫—Ä–µ–∞—Ç–æ—Ä—É –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –û—Ñ—Ñ–µ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## 8. –î–µ–π—Å—Ç–≤–∏—è —Ç–∞—Å–∫-–∫—Ä–µ–∞—Ç–æ—Ä–∞

–¢–∞—Å–∫-–∫—Ä–µ–∞—Ç–æ—Ä, –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –û—Ñ—Ñ–µ—Ä–∞:
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø.7 (–ø—Ä–æ–≤–µ—Ä–∫—É)
2. –î–∞—ë—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞ –≤ –û—Ñ—Ñ–µ—Ä–µ (–ø—É—Ç—ë–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏—è –û—Ñ—Ñ–µ—Ä–∞ –≤ –±–ª–æ–∫–µ \`[–ü–û–î–•–û–î]\`)`;

    db.prepare('INSERT INTO knowledge_instructions (id, category_id, title, content, tags, sort_order) VALUES (?, ?, ?, ?, ?, ?)').run(
      uuidv4(), offersCategoryId, '–ó–∞–≤–µ–¥–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤', offersInstructionContent, JSON.stringify(['–æ—Ñ—Ñ–µ—Ä', '–∑–∞–≤–µ–¥–µ–Ω–∏–µ', '—Ñ–æ—Ä–º–∞', '–Ω–µ–π–º–∏–Ω–≥']), 1
    );

    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º"
    const formsCategoryId = uuidv4();
    db.prepare('INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order) VALUES (?, ?, ?, ?, ?)').run(
      formsCategoryId, 'development', '–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º –ø–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∫–∞–º', 'Code', 2
    );

    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω–¥–∏–Ω–≥–æ–≤"
    const landingsCategoryId = uuidv4();
    db.prepare('INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order) VALUES (?, ?, ?, ?, ?)').run(
      landingsCategoryId, 'development', '–°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω–¥–∏–Ω–≥–æ–≤', 'FileText', 3
    );

    // === –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–¥–µ–ª–∞ –ö—Ä–µ–æ ===
    const creoCategoryId = uuidv4();
    db.prepare('INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order) VALUES (?, ?, ?, ?, ?)').run(
      creoCategoryId, 'creo', '–†–∞–±–æ—Ç–∞ —Å –∫—Ä–µ–∞—Ç–∏–≤–∞–º–∏', 'Globe', 1
    );

    // === –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–¥–µ–ª–∞ –ë–∞–∏–Ω–≥–∞ ===
    const buyingCategoryId = uuidv4();
    db.prepare('INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order) VALUES (?, ?, ?, ?, ?)').run(
      buyingCategoryId, 'buying', '–†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞—Ñ–∏–∫–æ–º', 'Globe', 1
    );

    console.log('‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π —Å–æ–∑–¥–∞–Ω—ã');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: is_result –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∑–∞–¥–∞—á
  const fileColumns = db.prepare("PRAGMA table_info(task_files)").all() as Array<{ name: string }>;
  const fileColumnNames = fileColumns.map(c => c.name);
  
  if (!fileColumnNames.includes('is_result')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ is_result –∫ —Ñ–∞–π–ª–∞–º –∑–∞–¥–∞—á...');
    db.exec("ALTER TABLE task_files ADD COLUMN is_result INTEGER DEFAULT 0");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è is_result –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: parent_task_id –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –ø–æ–¥–∑–∞–¥–∞—á
  if (!taskColumnNames.includes('parent_task_id')) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ parent_task_id –¥–ª—è –ø–æ–¥–∑–∞–¥–∞—á...');
    db.exec("ALTER TABLE tasks ADD COLUMN parent_task_id TEXT REFERENCES tasks(id) ON DELETE CASCADE");
    console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è parent_task_id –¥–ª—è –ø–æ–¥–∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ–Ω–æ—Å head_id –∏–∑ departments –≤ department_heads
  const existingHeads = db.prepare(`
    SELECT id as department_id, head_id FROM departments WHERE head_id IS NOT NULL
  `).all() as { department_id: string; head_id: string }[];

  for (const { department_id, head_id } of existingHeads) {
    const exists = db.prepare(`
      SELECT 1 FROM department_heads WHERE user_id = ? AND department_id = ?
    `).get(head_id, department_id);

    if (!exists) {
      console.log(`üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ–Ω–æ—Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è ${head_id} –≤ department_heads...`);
      db.prepare(`
        INSERT INTO department_heads (id, user_id, department_id)
        VALUES (?, ?, ?)
      `).run(uuidv4(), head_id, department_id);
    }
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–∞
  const guideInstructionExists = db.prepare(`
    SELECT 1 FROM knowledge_instructions WHERE title = '–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º'
  `).get();

  if (!guideInstructionExists) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º...');

    // –¢–µ–∫—Å—Ç—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–∞
    const devGuideContent = `# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º
## –î–ª—è –æ—Ç–¥–µ–ª–∞ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## –í–∞—à–∞ —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (webdev)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –≤–∞–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –Ω–∏–º
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã (—Ñ–∞–π–ª–æ–≤) –∫ –∑–∞–¥–∞—á–∞–º
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

### –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (dev_head)
–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –ø–ª—é—Å:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ "–ú–æ–π –æ—Ç–¥–µ–ª" —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –æ—Ç–¥–µ–ª–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –æ—Ç–¥–µ–ª–∞
- –û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–î–Ω–æ/–ù–æ—Ä–º/–¢–æ–ø)
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –æ—Ç–¥–µ–ª

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã —Å–∏—Å—Ç–µ–º—ã

### üìä –î–∞—à–±–æ—Ä–¥
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ–±—â–µ–π —Å–≤–æ–¥–∫–æ–π:
- –í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üì¶ –û—Ñ—Ñ–µ—Ä—ã
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ñ—Ñ–µ—Ä–∞—Ö (–ø—Ä–æ–¥—É–∫—Ç, –ì–ï–û, –ü–ü)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ü–ü –∏ –¥—Ä—É–≥–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

### ‚úÖ –ó–∞–¥–∞—á–∏
–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π —Ä–∞–∑–¥–µ–ª:
- **–ú–æ–∏ –∑–∞–¥–∞—á–∏** ‚Äî –∑–∞–¥–∞—á–∏, –≥–¥–µ –≤—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
- **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–π** ‚Äî –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏
- **–í—Å–µ –∑–∞–¥–∞—á–∏** ‚Äî –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ (–¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π)

#### –†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–µ–π:
1. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É –∫–ª–∏–∫–æ–º –ø–æ —Å—Ç—Ä–æ–∫–µ
2. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–µ—Ç ‚Üí –í —Ä–∞–±–æ—Ç–µ ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–æ
3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Ö–æ–¥—É —Ä–∞–±–æ—Ç—ã
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª-—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á:
- **–û–∂–∏–¥–∞–µ—Ç** ‚Äî –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞, –∂–¥—ë—Ç –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
- **–í —Ä–∞–±–æ—Ç–µ** ‚Äî –≤—ã –ø—Ä–∏—Å—Ç—É–ø–∏–ª–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** ‚Äî —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- **–û—Ç–º–µ–Ω–µ–Ω–æ** ‚Äî –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–æ–º

### üè¢ –û—Ç–¥–µ–ª—ã
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–º–ø–∞–Ω–∏–∏:
- –°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç–¥–µ–ª–æ–≤
- –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏

### üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞:
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—é –æ—Ñ—Ñ–µ—Ä–æ–≤
- –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ä–º–∞–º–∏ –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∫–∞–º–∏
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≥–∞–π–¥—ã

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

---

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
- –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –¥–µ–¥–ª–∞–π–Ω–∞ (–∑–∞ 24 —á–∞—Å–∞)
- –ü—Ä–æ—Å—Ä–æ—á–∫–µ –∑–∞–¥–∞—á–∏

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç:
- –í –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
- –í Telegram (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)

---

## –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –∏ —Å–æ–≤–µ—Ç—ã

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞—á
- –§–∏–ª—å—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- –ö–ª–∏–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–¥–∞—á–∏ –∫–æ–ø–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ—ë

---

## –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –æ—Ç–¥–µ–ª–∞ –∏–ª–∏ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.`;

    const creoGuideContent = `# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º
## –î–ª—è –æ—Ç–¥–µ–ª–∞ –ö—Ä–µ–æ

---

## –í–∞—à–∞ —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –ö—Ä–µ–æ –º–µ–Ω–µ–¥–∂–µ—Ä (creo_manager)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –≤–∞–º
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –Ω–∏–º
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã (–∫—Ä–µ–∞—Ç–∏–≤–æ–≤) –∫ –∑–∞–¥–∞—á–∞–º
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–æ—á–∏—Å—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞ –∫—Ä–µ–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

### –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –∫—Ä–µ–æ (creo_head)
–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫—Ä–µ–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –ø–ª—é—Å:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ "–ú–æ–π –æ—Ç–¥–µ–ª" —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –æ—Ç–¥–µ–ª–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –æ—Ç–¥–µ–ª–∞
- –û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–î–Ω–æ/–ù–æ—Ä–º/–¢–æ–ø)
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –æ—Ç–¥–µ–ª

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã —Å–∏—Å—Ç–µ–º—ã

### üìä –î–∞—à–±–æ—Ä–¥
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ–±—â–µ–π —Å–≤–æ–¥–∫–æ–π:
- –í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üì¶ –û—Ñ—Ñ–µ—Ä—ã
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ñ—Ñ–µ—Ä–∞—Ö (–ø—Ä–æ–¥—É–∫—Ç, –ì–ï–û, –ø–æ–¥—Ö–æ–¥)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ü–ü –∏ –¥—Ä—É–≥–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å–µ–π—á–∞—Å –≤ —Ä–∞–±–æ—Ç–µ

### ‚úÖ –ó–∞–¥–∞—á–∏
–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π —Ä–∞–∑–¥–µ–ª:
- **–ú–æ–∏ –∑–∞–¥–∞—á–∏** ‚Äî –∑–∞–¥–∞—á–∏, –≥–¥–µ –≤—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
- **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–π** ‚Äî –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏
- **–í—Å–µ –∑–∞–¥–∞—á–∏** ‚Äî –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ (–¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π)

#### –¢–∏–ø—ã –∑–∞–¥–∞—á –¥–ª—è –∫—Ä–µ–æ:
- **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫—Ä–µ–æ** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—Ä–µ–∞—Ç–∏–≤–æ–≤

#### –†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–µ–π:
1. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É –∫–ª–∏–∫–æ–º –ø–æ —Å—Ç—Ä–æ–∫–µ
2. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–µ—Ç ‚Üí –í —Ä–∞–±–æ—Ç–µ ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–æ
3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Ö–æ–¥—É —Ä–∞–±–æ—Ç—ã
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∫—Ä–µ–∞—Ç–∏–≤—ã –∫–∞–∫ —Ñ–∞–π–ª-—Ä–µ–∑—É–ª—å—Ç–∞—Ç

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á:
- **–û–∂–∏–¥–∞–µ—Ç** ‚Äî –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞, –∂–¥—ë—Ç –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
- **–í —Ä–∞–±–æ—Ç–µ** ‚Äî –≤—ã –ø—Ä–∏—Å—Ç—É–ø–∏–ª–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** ‚Äî –∫—Ä–µ–∞—Ç–∏–≤—ã –≥–æ—Ç–æ–≤—ã –∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- **–û—Ç–º–µ–Ω–µ–Ω–æ** ‚Äî –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–æ–º

### üè¢ –û—Ç–¥–µ–ª—ã
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–º–ø–∞–Ω–∏–∏:
- –°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç–¥–µ–ª–æ–≤
- –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏

### üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞:
- –ì–∞–π–¥—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫—Ä–µ–∞—Ç–∏–≤–æ–≤
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ä–º–∞—Ç–∞–º
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
–ü–æ–ª–µ–∑–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã:

#### –û—á–∏—Å—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
–£–¥–∞–ª–µ–Ω–∏–µ EXIF –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ü–æ–ª—É—á–∏—Ç–µ –æ—á–∏—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

#### –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JPG, PNG, WebP, GIF
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∂–∞—Ç–∏—è

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

---

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
- –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –¥–µ–¥–ª–∞–π–Ω–∞ (–∑–∞ 24 —á–∞—Å–∞)
- –ü—Ä–æ—Å—Ä–æ—á–∫–µ –∑–∞–¥–∞—á–∏

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç:
- –í –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
- –í Telegram (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ

1. **–í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** ‚Äî –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏–π –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∑–∞–¥–∞—á–µ
3. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ –¥–µ–¥–ª–∞–π–Ω–∞–º–∏** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–Ω–∏—Ç, –Ω–æ –ª—É—á—à–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ
4. **–û—á–∏—â–∞–π—Ç–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** ‚Äî –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫—Ä–µ–∞—Ç–∏–≤–æ–≤

---

## –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –æ—Ç–¥–µ–ª–∞ –∏–ª–∏ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.`;

    const buyingGuideContent = `# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º
## –î–ª—è –æ—Ç–¥–µ–ª–∞ –ë–∞–∏–Ω–≥–∞

---

## –í–∞—à–∞ —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –ë–∞–π–µ—Ä (buyer)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –≤–∞–º
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–¥–µ–ª–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∫—Ä–µ–æ
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –Ω–∏–º
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∑–∞–¥–∞—á–∞–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–æ—á–∏—Å—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞ –±–∞–∏–Ω–≥–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

### –ë–∏–∑–î–µ–≤ (bizdev)
–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–∞–π–µ—Ä–∞, –ø–ª—é—Å:
- –î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª—É "–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∏" (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–º–∏ —Å–µ—Ç—è–º–∏

### –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –±–∞–∏–Ω–≥–∞ (buying_head)
–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–∞–π–µ—Ä–∞ –∏ –±–∏–∑–¥–µ–≤–∞, –ø–ª—é—Å:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ "–ú–æ–π –æ—Ç–¥–µ–ª" —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –æ—Ç–¥–µ–ª–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –æ—Ç–¥–µ–ª–∞
- –û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–î–Ω–æ/–ù–æ—Ä–º/–¢–æ–ø)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç–¥–µ–ª–∞
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –æ—Ç–¥–µ–ª

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã —Å–∏—Å—Ç–µ–º—ã

### üìä –î–∞—à–±–æ—Ä–¥
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ–±—â–µ–π —Å–≤–æ–¥–∫–æ–π:
- –í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üè¢ –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∏ (–¥–ª—è bizdev –∏ buying_head)
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–º–∏ —Å–µ—Ç—è–º–∏:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ü–ü
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ü–ü
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤

### üì¶ –û—Ñ—Ñ–µ—Ä—ã
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞–º–∏:
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤ (bizdev, buying_head)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ü–ü, –ì–ï–û, —Ç–µ–º–∞—Ç–∏–∫–µ
- –ü—Ä–∏–≤—è–∑–∫–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤ –∫ –∑–∞–¥–∞—á–∞–º

#### –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞ (–¥–ª—è bizdev):
1. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –æ—Ñ—Ñ–µ—Ä"
2. –í—ã–±–µ—Ä–∏—Ç–µ –ü–ü
3. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–µ–º–∞—Ç–∏–∫—É, –ì–ï–û
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –∏ payout

### ‚úÖ –ó–∞–¥–∞—á–∏
–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π —Ä–∞–∑–¥–µ–ª:
- **–ú–æ–∏ –∑–∞–¥–∞—á–∏** ‚Äî –∑–∞–¥–∞—á–∏, –≥–¥–µ –≤—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
- **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–π** ‚Äî –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ—Ç–¥–µ–ª–æ–≤
- **–í—Å–µ –∑–∞–¥–∞—á–∏** ‚Äî –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:
1. –ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞—á–∏:
   - **–ó–∞–≤–µ—Å—Ç–∏ –ª–µ–Ω–¥** ‚Äî –¥–ª—è –æ—Ç–¥–µ–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
   - **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫—Ä–µ–æ** ‚Äî –¥–ª—è –æ—Ç–¥–µ–ª–∞ –∫—Ä–µ–æ
   - **–ó–∞–≤–µ—Å—Ç–∏ –≤ Keitaro** ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
   - **–î—Ä—É–≥–æ–µ** ‚Äî –ø—Ä–æ—á–∏–µ –∑–∞–¥–∞—á–∏
3. –£–∫–∞–∂–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –¥–µ–¥–ª–∞–π–Ω, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª—ã (–¢–ó)
5. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –æ—Ñ—Ñ–µ—Ä—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

#### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á:
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- –û—Å—Ç–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏–π
- –û—Ü–µ–Ω–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–¥–ª—è bizdev –∏ buying_head)
–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –æ—Ç–¥–µ–ª–∞–º
- –°—Ä–µ–¥–Ω–∏–µ —Å—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º

### üè¢ –û—Ç–¥–µ–ª—ã
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–º–ø–∞–Ω–∏–∏:
- –°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π

### üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞:
- –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä—Ç–Ω—ë—Ä–∫–∞–º–∏
- –ü—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–≤–µ–¥–µ–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–æ–≤
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
–ü–æ–ª–µ–∑–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:

#### –û—á–∏—Å—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
–£–¥–∞–ª–µ–Ω–∏–µ EXIF-–¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ (JPG, PNG, WebP)

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- –ü—Ä–∏–≤—è–∑–∫–∞ Telegram
- –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

---

## –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –¢–∏–ø–∏—á–Ω—ã–π —Ñ–ª–æ—É –∑–∞–ø—É—Å–∫–∞ –æ—Ñ—Ñ–µ—Ä–∞:

1. **–ë–∏–∑–î–µ–≤** –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –æ—Ç –ü–ü
2. **–ë–∏–∑–î–µ–≤** —Å–æ–∑–¥–∞—ë—Ç –æ—Ñ—Ñ–µ—Ä –≤ —Å–∏—Å—Ç–µ–º–µ
3. **–ë–∞–π–µ—Ä/–ë–∏–∑–î–µ–≤** —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: "–ó–∞–≤–µ—Å—Ç–∏ –ª–µ–Ω–¥"
4. **–ë–∞–π–µ—Ä/–ë–∏–∑–î–µ–≤** —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –¥–ª—è –∫—Ä–µ–æ: "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫—Ä–µ–æ"
5. **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫** –∑–∞–≤–æ–¥–∏—Ç –ª–µ–Ω–¥–∏–Ω–≥, –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"
6. **–ö—Ä–µ–æ –º–µ–Ω–µ–¥–∂–µ—Ä** –¥–µ–ª–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤—ã, –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
7. **–ë–∞–π–µ—Ä** –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤ —Ä–∞–±–æ—Ç—É

---

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤–∞–º–∏ –∑–∞–¥–∞—á
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –≤–∞—à–∏–º –∑–∞–¥–∞—á–∞–º

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç:
- –í –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
- –í Telegram (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)

---

## –°–æ–≤–µ—Ç—ã

1. **–ß—ë—Ç–∫–æ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –¢–ó** ‚Äî –ø—Ä–∏–∫—Ä–µ–ø–ª—è–π—Ç–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
2. **–£–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–µ–¥–ª–∞–π–Ω—ã** ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É –∫ –æ—Ñ—Ñ–µ—Ä—É** ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É
4. **–°—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** ‚Äî —Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

---

## –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –æ—Ç–¥–µ–ª–∞ –∏–ª–∏ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.`;

    const guides: Record<string, string> = {
      'development': devGuideContent,
      'creo': creoGuideContent,
      'buying': buyingGuideContent
    };

    const categoryTitle = '–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è';
    const instructionTitle = '–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º';

    for (const dept of ['development', 'creo', 'buying']) {
      // –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
      let category = db.prepare(`
        SELECT id FROM knowledge_categories WHERE department_code = ? AND title = ?
      `).get(dept, categoryTitle) as { id: string } | undefined;

      if (!category) {
        const categoryId = uuidv4();
        db.prepare(`
          INSERT INTO knowledge_categories (id, department_code, title, icon, sort_order)
          VALUES (?, ?, ?, 'BookOpen', 0)
        `).run(categoryId, dept, categoryTitle);
        category = { id: categoryId };
      }

      // –°–æ–∑–¥–∞—ë–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
      db.prepare(`
        INSERT INTO knowledge_instructions (id, category_id, title, content, tags, sort_order)
        VALUES (?, ?, ?, ?, ?, 0)
      `).run(
        uuidv4(),
        category.id,
        instructionTitle,
        guides[dept],
        JSON.stringify(['—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ', '–Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã', '–≥–∞–π–¥'])
      );
    }

    console.log('‚úÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –æ—Ç–¥–µ–ª–æ–≤');
  }

  // –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  const existingAchievements = db.prepare('SELECT COUNT(*) as count FROM achievements').get() as { count: number };
  if (existingAchievements.count < 30) {
    console.log('üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π...');
    
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
    const earnedAchievements = db.prepare('SELECT DISTINCT achievement_id FROM user_achievements').all() as { achievement_id: string }[];
    const earnedIds = earnedAchievements.map(a => a.achievement_id);
    
    // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª
    db.prepare(`DELETE FROM achievements WHERE id NOT IN (${earnedIds.length > 0 ? earnedIds.map(() => '?').join(',') : "''"})`)
      .run(...earnedIds);
    
    const achievements = [
      // === –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–¥–∞—á ===
      { code: 'tasks_5', name: '–ù–æ–≤–∏—á–æ–∫', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 5 –∑–∞–¥–∞—á', icon: 'üå±', category: 'tasks', threshold: 5, sort_order: 1 },
      { code: 'tasks_25', name: '–†–∞–±–æ—Ç—è–≥–∞', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 25 –∑–∞–¥–∞—á', icon: 'üí™', category: 'tasks', threshold: 25, sort_order: 2 },
      { code: 'tasks_50', name: '–ú–∞—à–∏–Ω–∞', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 50 –∑–∞–¥–∞—á', icon: 'üî•', category: 'tasks', threshold: 50, sort_order: 3 },
      { code: 'tasks_100', name: '–õ–µ–≥–µ–Ω–¥–∞', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 100 –∑–∞–¥–∞—á', icon: 'üëë', category: 'tasks', threshold: 100, sort_order: 4 },
      { code: 'tasks_250', name: '–¢–∏—Ç–∞–Ω', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 250 –∑–∞–¥–∞—á', icon: 'üèÜ', category: 'tasks', threshold: 250, sort_order: 5 },
      { code: 'tasks_500', name: '–ë–æ–≥–∞—Ç—ã—Ä—å', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 500 –∑–∞–¥–∞—á', icon: 'üåü', category: 'tasks', threshold: 500, sort_order: 6 },
      { code: 'tasks_1000', name: '–ë–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 1000 –∑–∞–¥–∞—á', icon: 'üíé', category: 'tasks', threshold: 1000, sort_order: 7 },
      
      // === –ü–æ –∫–∞—á–µ—Å—Ç–≤—É (—Ä–µ–π—Ç–∏–Ω–≥ "–¢–æ–ø") ===
      { code: 'quality_1', name: '–ü–µ—Ä–≤–∞—è –∑–≤–µ–∑–¥–∞', description: '–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ "–¢–æ–ø"', icon: '‚≠ê', category: 'quality', threshold: 1, sort_order: 1 },
      { code: 'quality_10', name: '–ó–≤—ë–∑–¥–Ω—ã–π', description: '10 –∑–∞–¥–∞—á —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º "–¢–æ–ø"', icon: 'üåü', category: 'quality', threshold: 10, sort_order: 2 },
      { code: 'quality_25', name: '–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç', description: '25 –∑–∞–¥–∞—á —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º "–¢–æ–ø"', icon: 'üíé', category: 'quality', threshold: 25, sort_order: 3 },
      { code: 'quality_50', name: '–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç', description: '50 –∑–∞–¥–∞—á —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º "–¢–æ–ø"', icon: 'üéñÔ∏è', category: 'quality', threshold: 50, sort_order: 4 },
      { code: 'quality_100', name: '–ë–µ–∑—É–ø—Ä–µ—á–Ω—ã–π', description: '100 –∑–∞–¥–∞—á —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º "–¢–æ–ø"', icon: 'üëë', category: 'quality', threshold: 100, sort_order: 5 },
      
      // === –ü–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–¥–æ—Å—Ä–æ—á–Ω–æ) ===
      { code: 'speed_5', name: '–°–ø—Ä–∏–Ω—Ç–µ—Ä', description: '5 –∑–∞–¥–∞—á –¥–æ—Å—Ä–æ—á–Ω–æ', icon: '‚ö°', category: 'speed', threshold: 5, sort_order: 1 },
      { code: 'speed_25', name: '–†–∞–∫–µ—Ç–∞', description: '25 –∑–∞–¥–∞—á –¥–æ—Å—Ä–æ—á–Ω–æ', icon: 'üöÄ', category: 'speed', threshold: 25, sort_order: 2 },
      { code: 'speed_50', name: '–ú–æ–ª–Ω–∏—è', description: '50 –∑–∞–¥–∞—á –¥–æ—Å—Ä–æ—á–Ω–æ', icon: 'üí®', category: 'speed', threshold: 50, sort_order: 3 },
      { code: 'speed_100', name: '–§–æ—Ä–º—É–ª–∞-1', description: '100 –∑–∞–¥–∞—á –¥–æ—Å—Ä–æ—á–Ω–æ', icon: 'üèéÔ∏è', category: 'speed', threshold: 100, sort_order: 4 },
      
      // === –ü–æ —Å—Ç—Ä–∏–∫—É ===
      { code: 'streak_7', name: '–ù–µ–¥–µ–ª—è –æ–≥–Ω—è', description: '7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏', icon: 'üìÖ', category: 'streak', threshold: 7, sort_order: 1 },
      { code: 'streak_30', name: '–ú–µ—Å—è—Ü –≤ —É–¥–∞—Ä–µ', description: '30 –¥–Ω–µ–π —Å—Ç—Ä–∏–∫', icon: 'üî•', category: 'streak', threshold: 30, sort_order: 2 },
      { code: 'streak_100', name: '–ù–µ–æ—Å—Ç–∞–Ω–æ–≤–∏–º—ã–π', description: '100 –¥–Ω–µ–π —Å—Ç—Ä–∏–∫', icon: 'üí™', category: 'streak', threshold: 100, sort_order: 3 },
      { code: 'streak_365', name: '–ñ–µ–ª–µ–∑–Ω–∞—è –≤–æ–ª—è', description: '365 –¥–Ω–µ–π —Å—Ç—Ä–∏–∫', icon: 'üèÜ', category: 'streak', threshold: 365, sort_order: 4 },
      
      // === –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ ===
      { code: 'first_task', name: '–ü–µ—Ä–≤—ã–π —à–∞–≥', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É', icon: 'üéØ', category: 'special', threshold: 1, sort_order: 1 },
      { code: 'veteran_year', name: '–í–µ—Ç–µ—Ä–∞–Ω', description: '1 –≥–æ–¥ –≤ —Å–∏—Å—Ç–µ–º–µ', icon: 'üéÇ', category: 'special', threshold: 365, sort_order: 2 },
      { code: 'veteran_2years', name: '–°—Ç–∞—Ä–æ–∂–∏–ª', description: '2 –≥–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ', icon: 'üéä', category: 'special', threshold: 730, sort_order: 3 },
      { code: 'early_bird', name: '–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞', description: '10 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–æ 9:00', icon: 'üåÖ', category: 'special', threshold: 10, sort_order: 4 },
      { code: 'night_owl', name: '–ü–æ–ª—É–Ω–æ—á–Ω–∏–∫', description: '10 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ 22:00', icon: 'üåô', category: 'special', threshold: 10, sort_order: 5 },
      { code: 'commentator', name: '–ö–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä', description: '–û—Å—Ç–∞–≤–∏—Ç—å 50 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤', icon: 'üìù', category: 'special', threshold: 50, sort_order: 6 },
      { code: 'team_player', name: '–ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–≥—Ä–æ–∫', description: '–£—á–∞—Å—Ç–∏–µ –≤ 10 –ø–æ–¥–∑–∞–¥–∞—á–∞—Ö', icon: 'ü§ù', category: 'special', threshold: 10, sort_order: 7 },
      { code: 'mentor', name: '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫', description: '–ü–æ—Å—Ç–∞–≤–∏—Ç—å 5 –æ—Ü–µ–Ω–æ–∫ "–¢–æ–ø" –∫–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫', icon: 'üéì', category: 'special', threshold: 5, sort_order: 8 },
      
      // === –û—Ç–¥–µ–ª–Ω—ã–µ ===
      { code: 'creo_master', name: '–ú–∞—Å—Ç–µ—Ä –∫—Ä–µ–æ', description: '50 –∑–∞–¥–∞—á –≤ –æ—Ç–¥–µ–ª–µ –ö—Ä–µ–æ', icon: 'üé®', category: 'special', threshold: 50, sort_order: 10 },
      { code: 'dev_guru', name: '–ì—É—Ä—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏', description: '50 –∑–∞–¥–∞—á –≤ –æ—Ç–¥–µ–ª–µ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏', icon: 'üíª', category: 'special', threshold: 50, sort_order: 11 },
      { code: 'buying_king', name: '–ö–æ—Ä–æ–ª—å –±–∞–∏–Ω–≥–∞', description: '50 –∑–∞–¥–∞—á –≤ –æ—Ç–¥–µ–ª–µ –ë–∞–∏–Ω–≥–∞', icon: 'üìà', category: 'special', threshold: 50, sort_order: 12 },
      
      // === –†–µ–¥–∫–∏–µ/–°–µ–∫—Ä–µ—Ç–Ω—ã–µ ===
      { code: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', description: '10 –∑–∞–¥–∞—á "–¢–æ–ø" –ø–æ–¥—Ä—è–¥', icon: 'ü¶Ñ', category: 'special', threshold: 10, sort_order: 20 },
      { code: 'marathon', name: '–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü', description: '20 –∑–∞–¥–∞—á –∑–∞ –æ–¥–Ω—É –Ω–µ–¥–µ–ª—é', icon: 'üèÉ', category: 'special', threshold: 20, sort_order: 21 },
      { code: 'universal', name: '–£–Ω–∏–≤–µ—Ä—Å–∞–ª', description: '–ó–∞–¥–∞—á–∏ –≤–æ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö', icon: 'üé™', category: 'special', threshold: 5, sort_order: 22 },
      { code: 'prophet', name: '–ü—Ä–æ–≤–∏–¥–µ—Ü', description: '5 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Ä–æ–≤–Ω–æ –≤ –¥–µ–¥–ª–∞–π–Ω', icon: 'üîÆ', category: 'special', threshold: 5, sort_order: 23 },
    ];

    const insertAchievement = db.prepare(`
      INSERT OR REPLACE INTO achievements (id, code, name, description, icon, category, threshold, sort_order)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `);

    for (const a of achievements) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
      const existing = db.prepare('SELECT id FROM achievements WHERE code = ?').get(a.code) as { id: string } | undefined;
      const id = existing?.id || uuidv4();
      insertAchievement.run(id, a.code, a.name, a.description, a.icon, a.category, a.threshold, a.sort_order);
    }

    console.log('‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  }
} catch (e) {
  console.error('Migration error:', e);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–æ–º–µ—Ä–∞ –∑–∞–¥–∞—á–∏
export function getNextTaskNumber(): number {
  const result = db.prepare('SELECT MAX(task_number) as max_num FROM tasks').get() as { max_num: number | null };
  return (result.max_num || 0) + 1;
}

export default db;

